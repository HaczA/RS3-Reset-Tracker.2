<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RS3 Resets Tracker</title>
<style>
  :root { --bg:#101014; --panel:#191c22; --muted:#9aa1ad; --accent:#6ecbff; }
  body { margin:0; font-family:system-ui, Segoe UI, Arial; background:var(--bg); color:#e9edf3; }
  .app { width:320px; padding:14px; }
  .card { background:var(--panel); border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.4); padding:14px; margin-bottom:12px; }
  h1 { font-size:18px; margin:0 0 10px; }
  .tabs { display:flex; gap:6px; margin:8px 0 10px; }
  .tab { flex:1; padding:8px; text-align:center; border-radius:10px; cursor:pointer; background:#22262f; }
  .tab.active { outline:2px solid var(--accent); }
  .row { display:flex; gap:8px; align-items:center; }
  .row > * { flex:1; }
  .pill { font-size:12px; padding:4px 8px; border-radius:999px; background:#232836; color:var(--muted); }
  .list { display:grid; gap:6px; margin-top:8px; }
  .item { display:flex; align-items:center; gap:8px; background:#141820; padding:8px; border-radius:10px; }
  .item a { color:#cfe7ff; text-decoration:none; }
  .muted { color:var(--muted); font-size:12px; }
  .controls { display:flex; gap:8px; }
  button { padding:8px 10px; border:0; border-radius:10px; background:#2a3140; color:#e9edf3; cursor:pointer; }
  button.primary { background:var(--accent); color:#0a0f16; font-weight:600; }
  input[type="text"] { width:100%; padding:8px; border-radius:8px; border:1px solid #2a3140; background:#0f131a; color:#e9edf3; }
  .small { font-size:11px; color:var(--muted); }
  #jsok { position:fixed; right:8px; top:8px; background:#2a3140; border-radius:10px; padding:4px 8px; font-size:12px; }
</style>
</head>
<body>
<div id="jsok">JS: loading…</div>

<div class="app">
  <div class="card">
    <h1>RS3 Resets Tracker</h1>
    <div class="muted">Saves progress locally. Reset schedule uses <b>game time (UTC)</b>.</div>
    <div class="row" style="margin-top:8px;">
      <select id="profile"></select>
      <button id="newProfile" type="button">New</button>
      <button id="delProfile" type="button">Del</button>
    </div>
    <div class="row">
      <div class="pill">Next daily: <span id="nextDaily">—</span></div>
      <div class="pill">Weekly: <span id="nextWeekly">—</span></div>
      <div class="pill">Monthly: <span id="nextMonthly">—</span></div>
    </div>
  </div>

  <div class="card">
    <div class="tabs">
      <div class="tab active" data-scope="daily">Dailies</div>
      <div class="tab" data-scope="weekly">Weeklies</div>
      <div class="tab" data-scope="monthly">Monthlies</div>
    </div>

    <div class="controls">
      <input id="addText" type="text" placeholder="Add task (optionally paste RS Wiki URL)"/>
      <button id="addBtn" class="primary" type="button">Add</button>
      <button id="clearDone" type="button">Clear Done</button>
    </div>

    <div class="controls" style="margin-top:6px;">
      <button id="importDailyScape" type="button">Import from DailyScape</button>
      <button id="resetScope" type="button">Reset This Tab</button>
    </div>

    <div class="list" id="list"></div>
    <div class="small" style="margin-top:8px;">
      Tip: Click the task name to edit. Drag to reorder. Progress auto-resets at UTC boundaries:
      dailies 00:00 UTC; weeklies 00:00 UTC Wednesdays; monthlies 00:00 UTC day 1.
    </div>
  </div>

  <div class="card"><div class="small">Sources: DailyScape (task lists, ideas) and known RS reset times.</div></div>
</div>

<script>
window.addEventListener('DOMContentLoaded', () => {
  document.getElementById("jsok").textContent = "JS: OK v16";
  try { if (window.alt1 && alt1.identifyAppUrl) { alt1.identifyAppUrl("https://hacza.github.io/RS3-Reset-Tracker.2/appconfig.json"); } } catch(e){}

  /* ===== State ===== */
  const LS_KEY = "rs3_resets_tracker_v1";
  let state = load() || initDefault();
  let currentScope = "daily";

  /* ===== Elements ===== */
  const el = (id) => document.getElementById(id);
  const listEl = el("list");
  const tabs = Array.from(document.querySelectorAll(".tab"));
  const profileSel = el("profile");

  /* ===== Profiles ===== */
  function refreshProfiles() {
    profileSel.innerHTML = "";
    state.profiles.forEach((p,i) => {
      const opt = document.createElement("option");
      opt.value = i; opt.textContent = p.name; profileSel.appendChild(opt);
    });
    profileSel.value = state.currentProfile;
  }
  el("newProfile").onclick = () => {
    const name = prompt("Profile name?","Main");
    if (!name) return;
    state.profiles.push(emptyProfile(name));
    state.currentProfile = String(state.profiles.length-1);
    save(); refreshProfiles(); render();
  };
  el("delProfile").onclick = () => {
    if (state.profiles.length <= 1) return alert("Keep at least one profile.");
    if (!confirm("Delete current profile?")) return;
    const idx = +state.currentProfile;
    state.profiles.splice(idx,1);
    state.currentProfile = "0";
    save(); r
